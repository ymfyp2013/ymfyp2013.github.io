<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Demo</title>
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css">
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
<style type="text/css">
#close-button {
	margin-right: 8px;
	position: fixed;
	right: 0;
}
body {
	background: transparent !important;
}
</style>
</head>
<body>
<div id="close-button">
<a href="index.html" data-role="button" data-icon="delete" data-iconpos="notext">Delete</a>
</div>
<canvas id="animated-comments">
</canvas>
<script>
var fontSize = 20;
var fps = 60;
var canvas = $('#animated-comments')[0];
var ctx = canvas.getContext('2d');
var t = 0;
var intervalID;
var comments;
function load_comments() {
	$.get('http://gateway-ymfyp2013.rhcloud.com/comments/' + window.location.hash.replace(/^#/, ''), function(data) {
		play_comments(data);
	});
}
function play_comments(data) {
	comments = data;
	ctx.font = fontSize.toString() + 'px sans-serif';
	intervalID = window.setInterval(draw_comments, 1000 / fps);
}
function draw_comments() {
	ctx.clearRect(0, 0, canvas.width, canvas.height)
	$.each(comments, function(index, value) {
		var x = canvas.width - (canvas.width + ctx.measureText(value).width) * 0.001 * t;
		if (x < - ctx.measureText(value).width) {
			window.clearInterval(intervalID);
			return;
		}
		var y = 1.5 * (index + 2) * fontSize;
		ctx.fillStyle = 'white';
	    ctx.strokeStyle = 'black';
		ctx.fillText(value, x, y);
		ctx.strokeText(value, x, y);
	});
	t = t + 1
}
$(window).bind('hashchange', function() {
	load_comments();
});
$('#animated-comments')[0].height = $(window).height();
$('#animated-comments')[0].width = $(window).width();
load_comments();
</script>
</body>
</html>